[TOC]

---

#  基于闪存的数据库管理系统的高效事务恢复提交协议：Flag Commit

---

## Abstract

- 研究在SLC闪存中运行的DBMSs如何高效得完成事务的恢复。
- 在传统的shadow-paging方式的基础上，提出了新的提交协议flagcommit，能利用flash的快速随机访问、异地更新、局部页编程的特性。
- 利用事务提交标志链内嵌事务状态到闪存页中以减少写log记录的需求。
- 设计了两种恢复协议：commit-based flag commit（CFC）和abort-based flag commit（AFC）。满足不同的性能需求。
- 基于TPC-C标准的测试，评估CFC和AFC性能优于已有的恢复协议。

---

## Introduction

- Flash以其优良特性备受关注，本文研究在事务恢复中如何利用SLC的优点以提高基于闪存的DBMSs的性能。
- 事务恢复作用：保证原子性（一系列动作要么全部完成，要么都不完成）和持久性（提交的写得到保证）。事务恢复已有实现：WAL和Shadow Paging。WAL：以日志的方式持久化旧数据，再原地更新，写操作太频繁。SP：以磁盘上的shadow-page对数据页做异地更新，系统维护一张page ID到disk address的映射表，性能问题使它在磁盘中表现不佳，但是在闪存中确是可取的。
- 循环提交（cyclic commit）是一种根据影子页提出的提交机制。为提交的事务的每一个页维护一个循环链表，通过检查这个表的存在与否确定该事务是否提交。根据这一思想产生两种提交协议：SCC（simple cyclic commit）& BPCC（back pointer cyclic commit）。但是应用中存在一些问题，如高并发等。
- 本文提出一种新的基于影子页的提交机制flagcommit，利用闪存页局部可编程特性保持对事务状态的追踪，在每个shadow page中存储事务的状态标志。基于这种思想本文提出两种提交协议：CFC（commit-based flag commit）& AFC（abort-based flag commit）。它们适用与不同负载、具有不同性能。
- 本文主要工作：
  - 首次提出基于闪存的DBMSs快速高效事务恢复机制，flagcommit。
  - 根据flagcommit提出两种事务恢复协议，以及每个协议针对事务处理、垃圾回收、恢复的算法。
  - 扩展上文提出的两种协议对通用DBMS的支持。
  - 对本文提出的协议做性能评估，结果显示性能提升量巨大。

---

## Background

本节主要内容：*研究背景、闪存特性、闪存转换层FTL*

### 闪存特性

* 物理特性：片－块（128k+4k）－页（2k+64byte），块为擦除单位，页为读写单位
* IO特性：高效随机访问、先块擦后页写、块擦除次数有限（故在FTL中实现异地更新）

### 闪存转换层FTL

- FTL的核心是在内存中维护一张逻辑地址到物理地址的映射表，闪存页的OOB区存储其逻辑地址，用以在启动时在FTL建立正向的映射表。
- 通过维护映射表实现异地更新。
- 维护一张空间表，拥有垃圾回收模块回收废弃的页。回收页：触发垃圾回收（如根据块中的废弃页数量）- 将块中有效页复制到空闲块中 - 擦除块 - 将该块挂接到空闲块表中。
- 利用分散写和擦除实现闪存的磨损均衡，以延长使用寿命。



ps：并没有像Introduction介绍的那样在本节介绍研究背景

---

## Basic Flag Commit Protocols

为了系统恢复时确定事务该重做还是丢弃，需要保持对数据库的更新状态以及事务状态的跟踪。shadow paging利用日志进行异地更新以记录事务状态。本文提出的flagcommit基于shadowpaging的方法和循环提交的思想。

flagcommit在每个影子页的OOB区存储一个指向属于同一个事务的之前一个flash page的指针，同时存储状态标志、页版本、事务ID，通过这个链可以找到属于该事务的所有页，通过页中的状态标志可以检查该事务的提交状态。

### Commit-Based Flag Commit

